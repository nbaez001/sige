package com.sige.gui;

import java.math.BigDecimal;
import java.util.List;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.sige.entidad.PagosTupa;
import com.sige.entidad.RequisitoTupa;
import com.sige.entidad.TipoTramite;
import com.sige.servicio.PagosTupaService;
import com.sige.servicio.RequisitoTupaService;
import com.sige.servicio.TipoTramiteService;
import com.sige.util.Injector;
import com.vaadin.annotations.AutoGenerated;
import com.vaadin.data.Item;
import com.vaadin.data.util.IndexedContainer;
import com.vaadin.server.ThemeResource;
import com.vaadin.shared.ui.label.ContentMode;
import com.vaadin.ui.AbsoluteLayout;
import com.vaadin.ui.Alignment;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.Label;
import com.vaadin.ui.Panel;
import com.vaadin.ui.Table;
import com.vaadin.ui.UI;
import com.vaadin.ui.VerticalLayout;
import com.vaadin.ui.Window;

public class DetalleRequisitosTupa extends CustomComponent implements
		ClickListener {

	@AutoGenerated
	private AbsoluteLayout mainLayout;
	@AutoGenerated
	private Panel pnlPagos;
	@AutoGenerated
	private AbsoluteLayout absoluteLayout_3;
	@AutoGenerated
	private Label lblDerechosPago;
	@AutoGenerated
	private Table tbDerechosPago;
	@AutoGenerated
	private Button btnCerrar;
	@AutoGenerated
	private Panel pnlRequisitos;
	@AutoGenerated
	private VerticalLayout verticalLayout_2;
	@AutoGenerated
	private Table tbDetalleRequisitos;
	@AutoGenerated
	private Panel panel_2;
	@AutoGenerated
	private AbsoluteLayout absoluteLayout_2;
	@AutoGenerated
	private Label lblAtencion;
	@AutoGenerated
	private Label lblAnio;
	@AutoGenerated
	private Label lblNombre;
	@AutoGenerated
	private Label label_4;
	@AutoGenerated
	private Label label_3;
	@AutoGenerated
	private Label label_2;
	@AutoGenerated
	private Label label_1;
	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */
	Log logger = LogFactory.getLog(DetalleRequisitosTupa.class);
	private CustomComponent quienLlama;
	private TipoTramiteService tipoTramiteService;
	private RequisitoTupaService requisitoTupaService;
	private PagosTupaService pagosTupaService;
	private List<PagosTupa> lsPagosTupa;
	private List<RequisitoTupa> lsrequisitosTupa;
	private String codTramite;
	private Button botonCerrar;
	/**
	 * The constructor should first build the main layout, set the composition
	 * root and then do any custom initialization.
	 * 
	 * The constructor will not be automatically regenerated by the visual
	 * editor.
	 */
	Window windowContiene;

	public DetalleRequisitosTupa(Window windowContiene,
			CustomComponent quienLlama, String codTramite) {

		buildMainLayout();
		setCompositionRoot(mainLayout);
		tipoTramiteService = Injector.obtenerServicio(TipoTramiteService.class);
		requisitoTupaService = Injector
				.obtenerServicio(RequisitoTupaService.class);
		pagosTupaService = Injector.obtenerServicio(PagosTupaService.class);
		this.windowContiene = windowContiene;
		this.quienLlama = quienLlama;
		postBuild();
		obtenerDetalleTramite(codTramite);

		// TODO add user code here
	}

	public void postBuild() {

		lblDerechosPago.setContentMode(ContentMode.HTML);
		label_3.setContentMode(ContentMode.HTML);
		label_1.setContentMode(ContentMode.HTML);

		btnCerrar.addClickListener((ClickListener) this);
		IndexedContainer contenido = new IndexedContainer();
		lblDerechosPago.setVisible(false);
		contenido.addContainerProperty("item", Integer.class, null);
		contenido.addContainerProperty("descripcion", String.class, null);
		tbDetalleRequisitos.setImmediate(true);

		tbDetalleRequisitos.setContainerDataSource(contenido);
		tbDetalleRequisitos.setVisibleColumns(new Object[] { "item",
				"descripcion" });
		tbDetalleRequisitos.setColumnHeader("item", "Item");
		tbDetalleRequisitos.setColumnHeader("descripcion", "Descripcion");
		tbDetalleRequisitos.setColumnWidth("item", 50);
		tbDetalleRequisitos.setColumnWidth("descripcion", 750);

		IndexedContainer contenidoPagos = new IndexedContainer();
		contenidoPagos.addContainerProperty("item", Integer.class, null);
		contenidoPagos.addContainerProperty("descripcion", String.class, null);
		contenidoPagos.addContainerProperty("costo", BigDecimal.class, null);

		tbDerechosPago.setContainerDataSource(contenidoPagos);
		tbDerechosPago.setImmediate(true);
		tbDerechosPago.setVisibleColumns(new Object[] { "item", "descripcion",
				"costo" });
		tbDerechosPago.setColumnHeader("item", "Item");
		tbDerechosPago.setColumnHeader("descripcion", "Descripcion");
		tbDerechosPago.setColumnHeader("costo", "Costo");
		tbDerechosPago.setColumnWidth("item", 30);
		tbDerechosPago.setColumnWidth("descripcion", 220);
		tbDerechosPago.setColumnWidth("costo", 50);

	}

	@Override
	public void buttonClick(ClickEvent event) {
		// TODO Auto-generated method stub
		if (event.getSource() == this.btnCerrar) {
			UI.getCurrent().removeWindow(windowContiene);
		}
	}

	public void obtenerDetalleTramite(String codTramite) {
		logger.info(codTramite);
		TipoTramite tipoTramite = tipoTramiteService
				.obtenerTipoTramitePorCod(codTramite);
		String anio = tipoTramite.getAnio();
		String nombre = tipoTramite.getNombre();
		int dias = tipoTramite.getTipoAten();
		logger.info("Año" + anio + "Nombre: " + nombre + "dias " + dias);
		lblAnio.setValue(anio);
		lblNombre.setValue(nombre);
		lblAtencion.setValue("" + dias + " dias");

		this.lsrequisitosTupa = requisitoTupaService
				.obtenerRequisitosPorTramite(codTramite);
		this.lsPagosTupa = pagosTupaService.obtenerPagosPorTramite(codTramite);
		for (RequisitoTupa r : lsrequisitosTupa) {
			logger.info(r.getDescripcion());
		}
		if (lsrequisitosTupa == null) {
			return;
		} else {
			getAllRequisitosTupa();
		}
		if (lsPagosTupa == null || lsPagosTupa.size() == 0) {
			lblDerechosPago.setVisible(true);
			tbDerechosPago.setVisible(false);
			lblDerechosPago.setValue("El Procedimiento es gratuito");
			lblDerechosPago
					.setIcon(new ThemeResource("images/botones/info.png"));
			tbDerechosPago.setWidth("1px");
			tbDerechosPago.setHeight("1px");
			pnlPagos.setHeight("45px");
			return;
		} else {

			getAllPagosTupa();
		}

	}

	@SuppressWarnings("unchecked")
	public void getAllPagosTupa() {
		IndexedContainer contenedor = (IndexedContainer) tbDerechosPago
				.getContainerDataSource();
		contenedor.removeAllItems();
		for (int i = 0; i < lsPagosTupa.size(); i++) {
			Item item = contenedor.addItem(i);
			item.getItemProperty("item").setValue(lsPagosTupa.get(i).getItem());
			item.getItemProperty("descripcion").setValue(
					lsPagosTupa.get(i).getDescripcion());
			item.getItemProperty("costo").setValue(
					lsPagosTupa.get(i).getCosto());
		}
	}

	@SuppressWarnings("unchecked")
	public void getAllRequisitosTupa() {
		IndexedContainer contenedor = (IndexedContainer) this.tbDetalleRequisitos
				.getContainerDataSource();
		contenedor.removeAllItems();
		for (int i = 0; i < this.lsrequisitosTupa.size(); i++) {
			Item item = contenedor.addItem(i);
			item.getItemProperty("item").setValue(
					this.lsrequisitosTupa.get(i).getItem());
			item.getItemProperty("descripcion").setValue(
					this.lsrequisitosTupa.get(i).getDescripcion());
		}
	}

	@AutoGenerated
	private AbsoluteLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new AbsoluteLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("100%");

		// top-level component properties
		setWidth("100.0%");
		setHeight("100.0%");

		// label_1
		label_1 = new Label();
		label_1.setImmediate(false);
		label_1.setWidth("220px");
		label_1.setHeight("20px");
		label_1.setValue("<b>DETALLE DEL PROCEDIMIENTO</b>");
		mainLayout.addComponent(label_1, "top:20.0px;left:180.0px;");

		// panel_2
		panel_2 = buildPanel_2();
		mainLayout.addComponent(panel_2, "top:40.0px;left:40.0px;");

		// pnlRequisitos
		pnlRequisitos = buildPnlRequisitos();
		mainLayout.addComponent(pnlRequisitos, "top:160.0px;left:40.0px;");

		// btnCerrar
		btnCerrar = new Button();
		btnCerrar.setCaption("Cerrar");
		btnCerrar.setImmediate(true);
		btnCerrar.setWidth("-1px");
		btnCerrar.setHeight("-1px");
		mainLayout.addComponent(btnCerrar, "top:420.0px;left:230.0px;");

		// pnlPagos
		pnlPagos = buildPnlPagos();
		mainLayout.addComponent(pnlPagos, "top:282.0px;left:41.0px;");

		return mainLayout;
	}

	@AutoGenerated
	private Panel buildPanel_2() {
		// common part: create layout
		panel_2 = new Panel();
		panel_2.setCaption("Procedimiento");
		panel_2.setImmediate(false);
		panel_2.setWidth("460px");
		panel_2.setHeight("120px");

		// absoluteLayout_2
		absoluteLayout_2 = buildAbsoluteLayout_2();
		panel_2.setContent(absoluteLayout_2);

		return panel_2;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsoluteLayout_2() {
		// common part: create layout
		absoluteLayout_2 = new AbsoluteLayout();
		absoluteLayout_2.setImmediate(false);
		absoluteLayout_2.setWidth("100.0%");
		absoluteLayout_2.setHeight("100.0%");

		// label_2
		label_2 = new Label();
		label_2.setImmediate(false);
		label_2.setWidth("-1px");
		label_2.setHeight("-1px");
		label_2.setValue("Nombre: ");
		absoluteLayout_2.addComponent(label_2, "top:4.0px;left:11.0px;");

		// label_3
		label_3 = new Label();
		label_3.setImmediate(false);
		label_3.setWidth("50px");
		label_3.setHeight("-1px");
		label_3.setValue("A&ntilde;o:");
		absoluteLayout_2.addComponent(label_3, "top:41.0px;left:11.0px;");

		// label_4
		label_4 = new Label();
		label_4.setImmediate(false);
		label_4.setWidth("-1px");
		label_4.setHeight("-1px");
		label_4.setValue("Atención:");
		absoluteLayout_2.addComponent(label_4, "top:71.0px;left:11.0px;");

		// lblNombre
		lblNombre = new Label();
		lblNombre.setImmediate(false);
		lblNombre.setWidth("388px");
		lblNombre.setHeight("37px");
		lblNombre.setValue("Label");
		absoluteLayout_2.addComponent(lblNombre, "top:4.0px;left:61.0px;");

		// lblAnio
		lblAnio = new Label();
		lblAnio.setImmediate(false);
		lblAnio.setWidth("388px");
		lblAnio.setHeight("-1px");
		lblAnio.setValue("Label");
		absoluteLayout_2.addComponent(lblAnio, "top:41.0px;left:61.0px;");

		// lblAtencion
		lblAtencion = new Label();
		lblAtencion.setImmediate(false);
		lblAtencion.setWidth("378px");
		lblAtencion.setHeight("-1px");
		lblAtencion.setValue("Label");
		absoluteLayout_2.addComponent(lblAtencion, "top:71.0px;left:61.0px;");

		return absoluteLayout_2;
	}

	@AutoGenerated
	private Panel buildPnlRequisitos() {
		// common part: create layout
		pnlRequisitos = new Panel();
		pnlRequisitos.setCaption("Requisitos");
		pnlRequisitos.setImmediate(false);
		pnlRequisitos.setWidth("460px");
		pnlRequisitos.setHeight("128px");

		// verticalLayout_2
		verticalLayout_2 = buildVerticalLayout_2();
		pnlRequisitos.setContent(verticalLayout_2);

		return pnlRequisitos;
	}

	@AutoGenerated
	private VerticalLayout buildVerticalLayout_2() {
		// common part: create layout
		verticalLayout_2 = new VerticalLayout();
		verticalLayout_2.setImmediate(false);
		verticalLayout_2.setWidth("100.0%");
		verticalLayout_2.setHeight("100.0%");
		verticalLayout_2.setMargin(false);

		// tbDetalleRequisitos
		tbDetalleRequisitos = new Table();
		tbDetalleRequisitos.setImmediate(false);
		tbDetalleRequisitos.setWidth("100.0%");
		tbDetalleRequisitos.setHeight("100px");
		verticalLayout_2.addComponent(tbDetalleRequisitos);
		verticalLayout_2.setComponentAlignment(tbDetalleRequisitos,
				new Alignment(48));

		return verticalLayout_2;
	}

	@AutoGenerated
	private Panel buildPnlPagos() {
		// common part: create layout
		pnlPagos = new Panel();
		pnlPagos.setCaption("Derechos de pago");
		pnlPagos.setImmediate(false);
		pnlPagos.setWidth("459px");
		pnlPagos.setHeight("134px");

		// absoluteLayout_3
		absoluteLayout_3 = buildAbsoluteLayout_3();
		pnlPagos.setContent(absoluteLayout_3);

		return pnlPagos;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsoluteLayout_3() {
		// common part: create layout
		absoluteLayout_3 = new AbsoluteLayout();
		absoluteLayout_3.setImmediate(false);
		absoluteLayout_3.setWidth("100.0%");
		absoluteLayout_3.setHeight("100.0%");

		// tbDerechosPago
		tbDerechosPago = new Table();
		tbDerechosPago.setImmediate(false);
		tbDerechosPago.setWidth("458px");
		tbDerechosPago.setHeight("100.0%");
		absoluteLayout_3.addComponent(tbDerechosPago, "top:21.0px;left:0.0px;");

		// lblDerechosPago
		lblDerechosPago = new Label();
		lblDerechosPago.setImmediate(false);
		lblDerechosPago.setWidth("-1px");
		lblDerechosPago.setHeight("-1px");
		lblDerechosPago.setValue("Label");
		absoluteLayout_3.addComponent(lblDerechosPago, "top:3.0px;left:0.0px;");

		return absoluteLayout_3;
	}

}
