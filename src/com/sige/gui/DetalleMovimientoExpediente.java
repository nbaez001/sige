package com.sige.gui;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

import com.sige.entidad.DocumentoInterno;
import com.sige.entidad.DocumentoInternoDestino;
import com.sige.entidad.Expediente;
import com.sige.entidad.ExpedienteMovimiento;
import com.sige.servicio.DocumentoInternoDestinoService;
import com.sige.servicio.DocumentoInternoService;
import com.sige.servicio.ExpedienteMovimientoServicio;
import com.sige.servicio.ExpedienteServicio;
import com.sige.servicio.TipoDocumentoServicio;
import com.sige.util.Injector;
import com.sige.util.SigeUtil;
import com.sige.util.TextField;
import com.vaadin.annotations.AutoGenerated;
import com.vaadin.shared.ui.label.ContentMode;
import com.vaadin.ui.AbsoluteLayout;
import com.vaadin.ui.Button;
import com.vaadin.ui.Button.ClickEvent;
import com.vaadin.ui.Button.ClickListener;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.Label;
import com.vaadin.ui.Panel;
import com.vaadin.ui.TextArea;
import com.vaadin.ui.UI;
import com.vaadin.ui.Window;

public class DetalleMovimientoExpediente extends CustomComponent implements
		ClickListener {

	/*- VaadinEditorProperties={"grid":"RegularGrid,20","showGrid":true,"snapToGrid":true,"snapToObject":true,"movingGuides":false,"snappingDistance":10} */

	@AutoGenerated
	private AbsoluteLayout mainLayout;
	@AutoGenerated
	private Button btnSalir;
	@AutoGenerated
	private TextField txtFechaEnvio;
	@AutoGenerated
	private TextField txtDependenciaOrigen;
	@AutoGenerated
	private Panel panel_4;
	@AutoGenerated
	private AbsoluteLayout absoluteLayout_3;
	@AutoGenerated
	private TextArea txtATexto;
	@AutoGenerated
	private TextField txtDocumento;
	@AutoGenerated
	private TextField txtDependenciaDestino;
	@AutoGenerated
	private TextField txtUsuarioRespuesta;
	@AutoGenerated
	private TextField txtFechaRespuesta;
	@AutoGenerated
	private Label label_11;
	@AutoGenerated
	private Label label_10;
	@AutoGenerated
	private Label label_9;
	@AutoGenerated
	private Label label_8;
	@AutoGenerated
	private Label label_7;
	@AutoGenerated
	private Label label_6;
	@AutoGenerated
	private Panel panel_2;
	@AutoGenerated
	private AbsoluteLayout absoluteLayout_2;
	@AutoGenerated
	private TextField txtUsuarioRecepcion;
	@AutoGenerated
	private TextField txtFechaRecepcion;
	@AutoGenerated
	private Label label_5;
	@AutoGenerated
	private Label label_4;
	@AutoGenerated
	private Label label_3;
	@AutoGenerated
	private Label label_2;
	@AutoGenerated
	private Label label_1;
	private Window windowContenido;
	private CustomComponent quienLlama;
	private ExpedienteMovimiento expedienteMovimiento;
	private TipoDocumentoServicio tipoDocumentoService;
	private ExpedienteServicio expedienteService;
	private ExpedienteMovimientoServicio expedienteMovimientoService;
	private DocumentoInternoService documentoInternoService;
	private DocumentoInternoDestinoService documentoInternoDestinoService;

	/**
	 * The constructor should first build the main layout, set the composition
	 * root and then do any custom initialization.
	 * 
	 * The constructor will not be automatically regenerated by the visual
	 * editor.
	 */
	public DetalleMovimientoExpediente(Window windowContenido,
			CustomComponent quienLlama,
			ExpedienteMovimiento expedienteMovimiento) {
		documentoInternoDestinoService = Injector
				.obtenerServicio(DocumentoInternoDestinoService.class);
		documentoInternoService = Injector
				.obtenerServicio(DocumentoInternoService.class);
		expedienteMovimientoService = Injector
				.obtenerServicio(ExpedienteMovimientoServicio.class);
		expedienteService = Injector.obtenerServicio(ExpedienteServicio.class);
		tipoDocumentoService = Injector
				.obtenerServicio(TipoDocumentoServicio.class);
		this.expedienteMovimiento = expedienteMovimiento;
		this.windowContenido = windowContenido;
		this.quienLlama = quienLlama;
		buildMainLayout();
		setCompositionRoot(mainLayout);
		postBuild();
		getDetalleMovimiento();
		// TODO add user code here
	}

	public void getDetalleMovimiento() {
		Log logger = LogFactory.getLog(DetalleMovimientoExpediente.class);
		logger.info("Cod Movi" + this.expedienteMovimiento.getId());
		Expediente expediente = expedienteMovimiento.getExpediente();
		DocumentoInterno docInterno = expedienteMovimiento
				.getDocumentoInterno();
		DocumentoInternoDestino docInternoDestino = documentoInternoDestinoService
				.obtenerDocInternoDestinoPorDocInterno(docInterno
						.getCodigodocumento());
		txtFechaEnvio.setValue(SigeUtil.obtenerFormatoFecha(docInterno
				.getFechadocumento()));
		if (docInternoDestino.getFechaRecepcion() != null) {
			txtFechaRecepcion
					.setValue(SigeUtil.obtenerFormatoFecha(docInternoDestino
							.getFechaRecepcion()));
			txtUsuarioRecepcion
					.setValue(docInternoDestino.getRecepcionadoPor());
		} else {
			txtFechaRecepcion.setValue("");
			txtUsuarioRecepcion.setValue("");
		}
		txtDependenciaOrigen.setValue(docInternoDestino.getDependencia()
				.getNombre());

		ExpedienteMovimiento movimientoRespuesta = expedienteMovimientoService
				.obtenerMovimientoPorCorrelativo(expediente,
						expedienteMovimiento.getCorrelativo() + 1);

		if (movimientoRespuesta == null) {
			txtFechaRespuesta.setValue("");
			txtUsuarioRespuesta.setValue("");
			txtDependenciaDestino.setValue("");
			txtDocumento.setValue("");
			txtATexto.setValue("");
		} else {
			logger.info("Mov Resp " + movimientoRespuesta.getId());
			DocumentoInterno docInternoRespuesta = movimientoRespuesta
					.getDocumentoInterno();
			DocumentoInternoDestino docInternodestinoRespuesta = documentoInternoDestinoService
					.obtenerDocInternoDestinoPorDocInterno(docInternoRespuesta
							.getCodigodocumento());
			txtFechaRespuesta.setValue(SigeUtil
					.obtenerFormatoFecha(docInternoRespuesta
							.getFechadocumento()));
			txtUsuarioRespuesta.setValue(docInternodestinoRespuesta
					.getCreadoPor());
			txtDependenciaDestino.setValue(docInternodestinoRespuesta
					.getDependencia().getNombre());
			txtDocumento.setValue(tipoDocumentoService.obtenerTipoDocumento(
					docInternoRespuesta.getCodigoTipoDocumento()).getNombre()
					+ "  "
					+ docInternoRespuesta.getCodigodocumento()
					+ "  "
					+ docInternoRespuesta.getAñoDocumento());
			txtATexto.setValue(docInternoRespuesta.getAsunto());
		}

	}

	public void postBuild() {

		label_6.setContentMode(ContentMode.HTML);
		label_2.setContentMode(ContentMode.HTML);
		label_1.setContentMode(ContentMode.HTML);
		label_3.setContentMode(ContentMode.HTML);

		txtFechaEnvio.setEnabled(false);
		txtDependenciaOrigen.setEnabled(false);
		txtUsuarioRecepcion.setEnabled(false);
		txtFechaRecepcion.setEnabled(false);
		txtFechaEnvio.setEnabled(false);
		txtFechaRespuesta.setEnabled(false);
		txtUsuarioRespuesta.setEnabled(false);
		txtDocumento.setEnabled(false);
		txtDependenciaDestino.setEnabled(false);
		txtATexto.setEnabled(false);
		btnSalir.addClickListener((ClickListener) this);
	}

	@Override
	public void buttonClick(ClickEvent event) {
		// TODO Auto-generated method stub
		if (event.getSource() == this.btnSalir) {
			UI.getCurrent().removeWindow(windowContenido);
		}
	}

	@AutoGenerated
	private AbsoluteLayout buildMainLayout() {
		// common part: create layout
		mainLayout = new AbsoluteLayout();
		mainLayout.setImmediate(false);
		mainLayout.setWidth("100%");
		mainLayout.setHeight("100%");

		// top-level component properties
		setWidth("100.0%");
		setHeight("100.0%");

		// label_1
		label_1 = new Label();
		label_1.setImmediate(false);
		label_1.setWidth("-1px");
		label_1.setHeight("-1px");
		label_1.setValue("<b>Dependencia  ");

		mainLayout.addComponent(label_1, "top:40.0px;left:20.0px;");

		// label_2
		label_2 = new Label();
		label_2.setImmediate(false);
		label_2.setWidth("-1px");
		label_2.setHeight("-1px");
		label_2.setValue("<b>Fecha que se env&iacute;a: ");

		mainLayout.addComponent(label_2, "top:20.0px;left:260.0px;");

		// panel_2
		panel_2 = buildPanel_2();
		mainLayout.addComponent(panel_2, "top:70.0px;left:18.0px;");

		// panel_4
		panel_4 = buildPanel_4();
		mainLayout.addComponent(panel_4, "top:147.0px;left:18.0px;");

		// txtDependenciaOrigen
		txtDependenciaOrigen = new TextField();
		txtDependenciaOrigen.setImmediate(false);
		txtDependenciaOrigen.setWidth("474px");
		txtDependenciaOrigen.setHeight("-1px");
		mainLayout.addComponent(txtDependenciaOrigen,
				"top:40.0px;left:106.0px;");

		// txtFechaEnvio
		txtFechaEnvio = new TextField();
		txtFechaEnvio.setImmediate(false);
		txtFechaEnvio.setWidth("200px");
		txtFechaEnvio.setHeight("-1px");
		mainLayout.addComponent(txtFechaEnvio, "top:14.0px;left:380.0px;");

		// btnSalir
		btnSalir = new Button();
		btnSalir.setCaption("Salir");
		btnSalir.setImmediate(true);
		btnSalir.setWidth("110px");
		btnSalir.setHeight("-1px");
		mainLayout.addComponent(btnSalir, "top:350.0px;left:240.0px;");

		return mainLayout;
	}

	@AutoGenerated
	private Panel buildPanel_2() {
		// common part: create layout
		panel_2 = new Panel();
		panel_2.setImmediate(false);
		panel_2.setWidth("562px");
		panel_2.setHeight("70px");

		// absoluteLayout_2
		absoluteLayout_2 = buildAbsoluteLayout_2();
		panel_2.setContent(absoluteLayout_2);

		return panel_2;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsoluteLayout_2() {
		// common part: create layout
		absoluteLayout_2 = new AbsoluteLayout();
		absoluteLayout_2.setImmediate(false);
		absoluteLayout_2.setWidth("100.0%");
		absoluteLayout_2.setHeight("100.0%");

		// label_3
		label_3 = new Label();
		label_3.setImmediate(false);
		label_3.setWidth("-1px");
		label_3.setHeight("-1px");
		label_3.setValue("<b>Recepci&oacute;n:");

		absoluteLayout_2.addComponent(label_3, "top:9.0px;left:10.0px;");

		// label_4
		label_4 = new Label();
		label_4.setImmediate(false);
		label_4.setWidth("-1px");
		label_4.setHeight("-1px");
		label_4.setValue("Fecha: ");
		absoluteLayout_2.addComponent(label_4, "top:29.0px;left:21.0px;");

		// label_5
		label_5 = new Label();
		label_5.setImmediate(false);
		label_5.setWidth("-1px");
		label_5.setHeight("-1px");
		label_5.setValue("Usuario: ");
		absoluteLayout_2.addComponent(label_5, "top:29.0px;left:281.0px;");

		// txtFechaRecepcion
		txtFechaRecepcion = new TextField();
		txtFechaRecepcion.setImmediate(false);
		txtFechaRecepcion.setWidth("180px");
		txtFechaRecepcion.setHeight("-1px");
		absoluteLayout_2.addComponent(txtFechaRecepcion,
				"top:27.0px;left:61.0px;");

		// txtUsuarioRecepcion
		txtUsuarioRecepcion = new TextField();
		txtUsuarioRecepcion.setImmediate(false);
		txtUsuarioRecepcion.setWidth("200px");
		txtUsuarioRecepcion.setHeight("-1px");
		absoluteLayout_2.addComponent(txtUsuarioRecepcion,
				"top:23.0px;left:341.0px;");

		return absoluteLayout_2;
	}

	@AutoGenerated
	private Panel buildPanel_4() {
		// common part: create layout
		panel_4 = new Panel();
		panel_4.setImmediate(false);
		panel_4.setWidth("562px");
		panel_4.setHeight("193px");

		// absoluteLayout_3
		absoluteLayout_3 = buildAbsoluteLayout_3();
		panel_4.setContent(absoluteLayout_3);

		return panel_4;
	}

	@AutoGenerated
	private AbsoluteLayout buildAbsoluteLayout_3() {
		// common part: create layout
		absoluteLayout_3 = new AbsoluteLayout();
		absoluteLayout_3.setImmediate(false);
		absoluteLayout_3.setWidth("100.0%");
		absoluteLayout_3.setHeight("100.0%");

		// label_6
		label_6 = new Label();
		label_6.setImmediate(false);
		label_6.setWidth("-1px");
		label_6.setHeight("-1px");
		label_6.setValue("<b>Respuesta: ");

		absoluteLayout_3.addComponent(label_6, "top:12.0px;left:10.0px;");

		// label_7
		label_7 = new Label();
		label_7.setImmediate(false);
		label_7.setWidth("-1px");
		label_7.setHeight("-1px");
		label_7.setValue("Fecha: ");
		absoluteLayout_3.addComponent(label_7, "top:34.0px;left:21.0px;");

		// label_8
		label_8 = new Label();
		label_8.setImmediate(false);
		label_8.setWidth("-1px");
		label_8.setHeight("-1px");
		label_8.setValue("Usuario: ");
		absoluteLayout_3.addComponent(label_8, "top:34.0px;left:281.0px;");

		// label_9
		label_9 = new Label();
		label_9.setImmediate(false);
		label_9.setWidth("60px");
		label_9.setHeight("-1px");
		label_9.setValue("Enviado a: ");
		absoluteLayout_3.addComponent(label_9, "top:60.0px;left:28.0px;");

		// label_10
		label_10 = new Label();
		label_10.setImmediate(false);
		label_10.setWidth("-1px");
		label_10.setHeight("-1px");
		label_10.setValue("Documento: ");
		absoluteLayout_3.addComponent(label_10, "top:92.0px;left:21.0px;");

		// label_11
		label_11 = new Label();
		label_11.setImmediate(false);
		label_11.setWidth("-1px");
		label_11.setHeight("-1px");
		label_11.setValue("Texto");
		absoluteLayout_3.addComponent(label_11, "top:120.0px;left:58.0px;");

		// txtFechaRespuesta
		txtFechaRespuesta = new TextField();
		txtFechaRespuesta.setImmediate(false);
		txtFechaRespuesta.setWidth("180px");
		txtFechaRespuesta.setHeight("-1px");
		absoluteLayout_3.addComponent(txtFechaRespuesta,
				"top:28.0px;left:61.0px;");

		// txtUsuarioRespuesta
		txtUsuarioRespuesta = new TextField();
		txtUsuarioRespuesta.setImmediate(false);
		txtUsuarioRespuesta.setWidth("200px");
		txtUsuarioRespuesta.setHeight("-1px");
		absoluteLayout_3.addComponent(txtUsuarioRespuesta,
				"top:28.0px;left:341.0px;");

		// txtDependenciaDestino
		txtDependenciaDestino = new TextField();
		txtDependenciaDestino.setImmediate(false);
		txtDependenciaDestino.setWidth("453px");
		txtDependenciaDestino.setHeight("-1px");
		absoluteLayout_3.addComponent(txtDependenciaDestino,
				"top:54.0px;left:88.0px;");

		// txtDocumento
		txtDocumento = new TextField();
		txtDocumento.setImmediate(false);
		txtDocumento.setWidth("253px");
		txtDocumento.setHeight("-1px");
		absoluteLayout_3.addComponent(txtDocumento, "top:86.0px;left:88.0px;");

		// txtATexto
		txtATexto = new TextArea();
		txtATexto.setImmediate(false);
		txtATexto.setWidth("453px");
		txtATexto.setHeight("56px");
		absoluteLayout_3.addComponent(txtATexto, "top:116.0px;left:88.0px;");

		return absoluteLayout_3;
	}

}
